[tox]
envlist =
    py{37,38,39,310}
    precommit
    mypy

isolated_build = True


[testenv]
setenv =
    PYTHONDONTWRITEBYTECODE=1


[testenv:py{37,38,39,310}]

poetry_add_dev_dependencies = True

deps =
    pytest~=6.2.5

commands = python -m pytest {posargs:tests} -vv


[testenv:precommit]
deps =
    pre-commit~=2.16.0
commands = pre-commit run --all-files --show-diff-on-failure


[testenv:mypy]
poetry_add_dev_dependencies = True
commands =
    bash -c "mypy . --strict | mypy-json-report > known-mypy-errors.json"
    git diff --exit-code known-mypy-errors.json
allowlist_externals =
    bash
    git
