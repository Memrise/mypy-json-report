[tox]
envlist =
    py{37,38,39,310}
    precommit
    mypy

isolated_build = True


[gh-actions]
python =
    3.7: py37,mypy
    3.8: py38
    3.9: py39
    3.10: py310


[testenv]
setenv =
    PYTHONDONTWRITEBYTECODE=1


[testenv:py{37,38,39,310}]

poetry_add_dev_dependencies = True

deps =
    pytest~=6.2.5

commands = python -m pytest {posargs:tests} -vv


[testenv:mypy]
poetry_add_dev_dependencies = True
commands =
    bash -c "mypy . --strict | mypy-json-report > known-mypy-errors.json"
    git diff --exit-code known-mypy-errors.json
allowlist_externals =
    bash
    git
